<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.local/DATA_STORES/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>EISLAW Data Bible - EISLAW Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">EISLAW Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../INDEX/" class="nav-link">Index</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKING_MEMORY/" class="nav-link">Working Memory</a>
                            </li>
                            <li class="navitem">
                                <a href="../Testing_Episodic_Log/" class="nav-link">Episodic Log</a>
                            </li>
                            <li class="navitem">
                                <a href="../TEAM_INBOX/" class="nav-link">Team Inbox</a>
                            </li>
                            <li class="navitem">
                                <a href="../DEV_WORKFLOW_DIAGRAM/" class="nav-link">Development Workflow Diagram</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKFLOW_UPDATE_ANALYSIS/" class="nav-link">Workflow Update Analysis</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_SKILLS_ARCHITECTURE/" class="nav-link">Skills Architecture Research</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_VM_STORAGE_MIGRATION/" class="nav-link">VM Storage Migration Research</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#eislaw-data-bible" class="nav-link">EISLAW Data Bible</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#data-locations-summary" class="nav-link">Data Locations Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#database-schema" class="nav-link">Database Schema</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#report-hosting-options-ceo-decision-pending" class="nav-link">Report Hosting Options (CEO Decision Pending)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#tasks-storage-json" class="nav-link">Tasks Storage (JSON)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#external-services" class="nav-link">External Services</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#airtable-schema-complete-field-reference" class="nav-link">Airtable Schema (Complete Field Reference)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#data-flow-diagrams" class="nav-link">Data Flow Diagrams</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#data-storage-policy" class="nav-link">Data Storage Policy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#api-endpoints-actual" class="nav-link">API Endpoints (Actual)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#maintenance" class="nav-link">Maintenance</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#change-log" class="nav-link">Change Log</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="eislaw-data-bible">EISLAW Data Bible</h1>
<p><strong>Last Updated:</strong> 2025-12-08
<strong>Owner:</strong> Joseph (Database) + Joe (CTO)
<strong>Status:</strong> AUTHORITATIVE SOURCE OF TRUTH</p>
<p>This document is the <strong>single source of truth</strong> for all data storage in EISLAW.
AI agents and developers MUST reference this document before accessing any data.</p>
<hr />
<h2 id="data-locations-summary">Data Locations Summary</h2>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>Storage Type</th>
<th>Location</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Clients</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>clients</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Airtable Contacts</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>airtable_contacts</code></td>
<td>âœ… Active (table created)</td>
</tr>
<tr>
<td><strong>Contacts</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>contacts</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Tasks</strong></td>
<td>JSON</td>
<td><code>~/.eislaw/store/tasks.json</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Task Attachments</strong></td>
<td>JSON (in task)</td>
<td><code>tasks.attachments[]</code> array</td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Quote Templates</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>quote_templates</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Agent Approvals</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>agent_approvals</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Agent Settings</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>agent_settings</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Activity Log</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>activity_log</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Sync State</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>sync_state</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Emails (index)</strong></td>
<td>SQLite</td>
<td><code>clients/email_index.sqlite</code></td>
<td>âœ… Separate DB</td>
</tr>
<tr>
<td><strong>Emails (content)</strong></td>
<td>JSON files</td>
<td><code>clients/*/emails/{thread}/{msg}.json</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Emails (source)</strong></td>
<td>Microsoft Graph</td>
<td>Outlook mailbox</td>
<td>âœ… External</td>
</tr>
<tr>
<td><strong>Documents</strong></td>
<td>SharePoint</td>
<td>Client folders via Graph API</td>
<td>âœ… External</td>
</tr>
<tr>
<td><strong>Recordings (metadata)</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>recordings</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Transcripts</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>transcripts</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>RAG Documents</strong></td>
<td>SQLite</td>
<td><code>data/eislaw.db</code> â†’ <code>rag_documents</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>RAG Index</strong></td>
<td>Meilisearch</td>
<td>Port 7700</td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Recordings (files)</strong></td>
<td>Files</td>
<td><code>recordings/</code> + SharePoint</td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Privacy Submissions</strong></td>
<td>SQLite</td>
<td><code>data/privacy.db</code> â†’ <code>privacy_submissions</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Privacy Activity Log</strong></td>
<td>SQLite</td>
<td><code>data/privacy.db</code> â†’ <code>activity_log</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Privacy Reports</strong></td>
<td>TBD</td>
<td>See "Report Hosting Options" below</td>
<td>â³ CEO Decision Pending</td>
</tr>
<tr>
<td><strong>Settings</strong></td>
<td>JSON</td>
<td><code>config/*.json</code></td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Secrets</strong></td>
<td>JSON</td>
<td><code>secrets.local.json</code></td>
<td>âœ… Local only</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="database-schema">Database Schema</h2>
<h3 id="main-database-eislawdb">Main Database: <code>eislaw.db</code></h3>
<p><strong>Location:</strong> <code>data/eislaw.db</code> (Docker: <code>/app/data/eislaw.db</code>)
<strong>Tables:</strong> 15 total (privacy moved to separate privacy.db)</p>
<h4 id="1-clients-22-columns">1. clients (22 columns)</h4>
<pre><code class="language-sql">CREATE TABLE clients (
    id TEXT PRIMARY KEY,
    name TEXT,
    email TEXT,
    phone TEXT,
    stage TEXT,
    types TEXT,
    airtable_id TEXT,
    airtable_url TEXT,
    sharepoint_url TEXT,
    local_folder TEXT,
    active INTEGER,
    notes TEXT,
    created_at TEXT,
    updated_at TEXT,
    last_synced_at TEXT,
    sync_source TEXT,
    slug TEXT,
    sharepoint_id TEXT,
    last_activity_at TEXT,
    archived INTEGER DEFAULT 0,
    archived_at TEXT,
    archived_reason TEXT
);
CREATE INDEX IF NOT EXISTS idx_clients_archived ON clients(archived);
</code></pre>
<h4 id="2-contacts-12-rows">2. contacts (12 rows)</h4>
<pre><code class="language-sql">CREATE TABLE contacts (
    id TEXT PRIMARY KEY,
    client_id TEXT,          -- FK to clients.id
    name TEXT,
    email TEXT,
    phone TEXT,
    role TEXT,
    notes TEXT,
    created_at TEXT,
    updated_at TEXT
);
</code></pre>
<h4 id="3-airtable_contacts-airtable-sink">3. airtable_contacts (Airtable sink)</h4>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS airtable_contacts (
    id TEXT PRIMARY KEY,
    airtable_id TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    email TEXT,
    phone TEXT,
    types TEXT,
    stage TEXT,
    notes TEXT,
    whatsapp_url TEXT,
    meeting_email_url TEXT,
    airtable_created_at TEXT,
    airtable_modified_at TEXT,
    activated INTEGER DEFAULT 0,
    activated_at TEXT,
    client_id TEXT,
    first_synced_at TEXT DEFAULT (datetime('now')),
    last_synced_at TEXT DEFAULT (datetime('now')),
    sync_hash TEXT,
    FOREIGN KEY (client_id) REFERENCES clients(id)
);

CREATE INDEX IF NOT EXISTS idx_airtable_contacts_airtable_id ON airtable_contacts(airtable_id);
CREATE INDEX IF NOT EXISTS idx_airtable_contacts_name ON airtable_contacts(name);
CREATE INDEX IF NOT EXISTS idx_airtable_contacts_activated ON airtable_contacts(activated);
CREATE INDEX IF NOT EXISTS idx_airtable_contacts_client ON airtable_contacts(client_id);
</code></pre>
<h4 id="4-tasks-not-in-sqlite">4. tasks - âš ï¸ NOT IN SQLITE!</h4>
<p><strong>Note:</strong> Tasks are stored in JSON file, NOT in SQLite.</p>
<p>See <a href="#tasks-storage-json">Tasks Storage</a> section below.</p>
<h4 id="5-quote_templates-3-rows">5. quote_templates (3 rows)</h4>
<pre><code class="language-sql">CREATE TABLE quote_templates (
    id TEXT PRIMARY KEY,
    name TEXT,
    category TEXT,
    content TEXT,            -- Template content
    variables TEXT,          -- JSON array of variable names
    created_at TEXT,
    updated_at TEXT,
    created_by TEXT,
    version INTEGER
);
</code></pre>
<h4 id="6-agent_approvals-2-rows">6. agent_approvals (2 rows)</h4>
<pre><code class="language-sql">CREATE TABLE agent_approvals (
    id TEXT PRIMARY KEY,
    agent_id TEXT,
    tool_id TEXT,
    action_name TEXT,
    action_name_he TEXT,     -- Hebrew display name
    description TEXT,
    context TEXT,
    parameters TEXT,         -- JSON
    risk_level TEXT,         -- 'low', 'medium', 'high'
    status TEXT,             -- 'pending', 'approved', 'rejected'
    created_at TEXT,
    expires_at TEXT,
    resolved_at TEXT,
    resolved_by TEXT,
    reject_reason TEXT,
    execution_result TEXT
);
</code></pre>
<h4 id="7-agent_settings">7. agent_settings</h4>
<pre><code class="language-sql">CREATE TABLE agent_settings (
    agent_id TEXT PRIMARY KEY,
    enabled INTEGER,
    auto_trigger INTEGER,
    approval_required INTEGER,
    max_actions_per_hour INTEGER,
    allowed_tools TEXT,      -- JSON array
    blocked_tools TEXT,      -- JSON array
    custom_prompt TEXT,
    settings_json TEXT,
    updated_at TEXT,
    updated_by TEXT
);
</code></pre>
<h4 id="8-activity_log-3-rows">8. activity_log (3 rows)</h4>
<pre><code class="language-sql">CREATE TABLE activity_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT,
    event_type TEXT,
    entity_type TEXT,
    entity_id TEXT,
    details TEXT,            -- JSON
    duration_ms INTEGER,
    success INTEGER,
    user_id TEXT
);
</code></pre>
<h4 id="9-sync_state">9. sync_state</h4>
<pre><code class="language-sql">CREATE TABLE sync_state (
    id TEXT PRIMARY KEY,
    source TEXT,             -- 'airtable', 'graph', etc.
    entity_type TEXT,
    last_sync_at TEXT,
    last_sync_cursor TEXT,
    status TEXT,
    error_message TEXT,
    records_synced INTEGER
);
</code></pre>
<h4 id="10-recordings-32-rows">10. recordings (32 rows)</h4>
<p>Stores Zoom cloud recordings and uploaded audio files.
- Primary source: Zoom API sync + manual uploads
- Status flow: in_zoom â†’ downloading â†’ downloaded â†’ transcribing â†’ completed</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS recordings (
    id TEXT PRIMARY KEY,
    zoom_id TEXT UNIQUE,
    zoom_meeting_id TEXT,
    topic TEXT NOT NULL,
    date TEXT,
    start_time TEXT,
    duration_minutes INTEGER,
    file_type TEXT,           -- M4A, MP4, WAV, etc.
    file_size_mb REAL,
    download_url TEXT,
    azure_blob TEXT,          -- Path in Azure Blob Storage
    local_path TEXT,          -- Path on VM filesystem
    status TEXT DEFAULT 'pending',  -- in_zoom, downloading, downloaded, transcribing, completed, error, skipped
    error TEXT,
    client_id TEXT,           -- FK to clients.id (nullable)
    domain TEXT,              -- Client_Work, Personal, Webinar
    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),
    downloaded_at TEXT,
    transcribed_at TEXT,
    synced_at TEXT,
    FOREIGN KEY (client_id) REFERENCES clients(id)
);

CREATE INDEX IF NOT EXISTS idx_recordings_zoom_id ON recordings(zoom_id);
CREATE INDEX IF NOT EXISTS idx_recordings_status ON recordings(status);
CREATE INDEX IF NOT EXISTS idx_recordings_date ON recordings(date);
CREATE INDEX IF NOT EXISTS idx_recordings_client ON recordings(client_id);
</code></pre>
<h4 id="11-transcripts-32-rows">11. transcripts (32 rows)</h4>
<p>Stores transcript text and metadata.
- Primary source: Gemini/Whisper transcription + manual imports
- Status flow: draft â†’ reviewed â†’ published</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS transcripts (
    id TEXT PRIMARY KEY,
    recording_id TEXT,        -- FK to recordings.id (nullable for manual uploads)
    title TEXT,               -- Display name
    content TEXT,             -- Full transcript text
    segments TEXT,            -- JSON array: [{speaker, start, end, text}, ...]
    language TEXT DEFAULT 'he',
    model_used TEXT,          -- gemini-1.5-flash, gemini-1.5-pro, whisper, manual
    status TEXT DEFAULT 'draft',  -- draft, reviewed, published
    domain TEXT,              -- Client_Work, Personal, Webinar
    client_id TEXT,           -- FK to clients.id (nullable)
    tags TEXT,                -- JSON array of tag strings
    file_path TEXT,           -- Path to source .txt file
    audio_path TEXT,          -- Path to source audio file
    word_count INTEGER,
    duration_seconds INTEGER,
    hash TEXT,                -- MD5 hash of first 1MB (for dedup)
    created_at TEXT DEFAULT (datetime('now')),
    updated_at TEXT DEFAULT (datetime('now')),
    published_at TEXT,
    reviewed_by TEXT,
    FOREIGN KEY (recording_id) REFERENCES recordings(id),
    FOREIGN KEY (client_id) REFERENCES clients(id)
);

CREATE INDEX IF NOT EXISTS idx_transcripts_recording ON transcripts(recording_id);
CREATE INDEX IF NOT EXISTS idx_transcripts_status ON transcripts(status);
CREATE INDEX IF NOT EXISTS idx_transcripts_client ON transcripts(client_id);
CREATE INDEX IF NOT EXISTS idx_transcripts_hash ON transcripts(hash);
</code></pre>
<h4 id="12-rag_documents-0-rows">12. rag_documents (0 rows)</h4>
<p>Stores chunked text for Meilisearch indexing.
- Created when transcript is published
- Links to Meilisearch document IDs</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS rag_documents (
    id TEXT PRIMARY KEY,
    transcript_id TEXT NOT NULL,  -- FK to transcripts.id
    chunk_index INTEGER,          -- Order within transcript
    chunk_text TEXT NOT NULL,     -- Text chunk for embedding
    meilisearch_id TEXT,          -- ID in Meilisearch index
    embedding_model TEXT,         -- Model used for embedding
    indexed_at TEXT,
    FOREIGN KEY (transcript_id) REFERENCES transcripts(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_rag_docs_transcript ON rag_documents(transcript_id);
CREATE INDEX IF NOT EXISTS idx_rag_docs_meili ON rag_documents(meilisearch_id);
</code></pre>
<h3 id="privacy-database-privacydb">Privacy Database: <code>privacy.db</code></h3>
<p><strong>Location:</strong> <code>data/privacy.db</code> (Docker: <code>/app/data/privacy.db</code>)
<strong>Tables:</strong> 2 total (privacy_submissions, activity_log)</p>
<blockquote>
<p><strong>Note:</strong> Privacy data is stored in a SEPARATE database from eislaw.db.
This allows independent backup/restore of privacy questionnaire data.</p>
</blockquote>
<h4 id="privacy_submissions-21-rows-as-of-2025-12-07">privacy_submissions (21 rows as of 2025-12-07)</h4>
<p>Stores privacy assessment questionnaire submissions from Fillout webhook.
- Primary source: Fillout webhook (<code>/api/privacy/webhook</code>)
- Contains contact info + all answers + calculated scores (embedded)</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS privacy_submissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    submission_id TEXT UNIQUE,        -- Fillout submission ID (UUID)
    form_id TEXT,                     -- Fillout form ID (t9nJNoMdBgus)
    submitted_at TEXT,                -- ISO timestamp from Fillout
    received_at TEXT,                 -- When webhook received it

    -- Contact Info
    contact_name TEXT,
    contact_email TEXT,
    contact_phone TEXT,
    business_name TEXT,

    -- All Answers (stored as JSON)
    answers_json TEXT,                -- Full form answers as JSON object

    -- Calculated Scores (embedded, not separate table)
    score_level TEXT,                 -- lone, basic, mid, high
    score_color TEXT,                 -- yellow, orange, red
    score_dpo INTEGER,                -- 0/1 - DPO required
    score_reg INTEGER,                -- 0/1 - Registration required
    score_report INTEGER,             -- 0/1 - Annual report required
    score_requirements TEXT,          -- JSON array of requirement strings
    score_confidence REAL,            -- Optional confidence score

    -- Review Workflow
    review_status TEXT DEFAULT 'pending',  -- pending, approved, rejected
    reviewed_at TEXT,
    override_level TEXT,              -- Manual override of calculated level
    override_reason TEXT
);
</code></pre>
<h4 id="activity_log">activity_log</h4>
<p>Tracks webhook events and system activities for monitoring.</p>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS activity_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT DEFAULT CURRENT_TIMESTAMP,
    event_type TEXT NOT NULL,         -- webhook_received, webhook_duplicate, webhook_error
    submission_id TEXT,
    details TEXT,                     -- JSON with event details
    duration_ms INTEGER,
    success BOOLEAN
);
</code></pre>
<hr />
<h2 id="report-hosting-options-ceo-decision-pending">Report Hosting Options (CEO Decision Pending)</h2>
<p><strong>Context:</strong> After privacy scoring, we need to deliver reports to clients. Three options under consideration:</p>
<h3 id="option-1-wordpress-dynamic-page">Option 1: WordPress Dynamic Page</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage</strong></td>
<td>None - rendered on demand</td>
</tr>
<tr>
<td><strong>URL</strong></td>
<td><code>https://eislaw.co.il/privacy-report/?token=abc123</code></td>
</tr>
<tr>
<td><strong>Data source</strong></td>
<td><code>privacy_submissions</code> table via API</td>
</tr>
<tr>
<td><strong>Implementation</strong></td>
<td>WordPress plugin + API endpoint</td>
</tr>
</tbody>
</table>
<h3 id="option-2-email-only-no-external-link">Option 2: Email-Only (No External Link)</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage</strong></td>
<td>None - full report sent in email body</td>
</tr>
<tr>
<td><strong>URL</strong></td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Data source</strong></td>
<td>Generated from <code>privacy_submissions</code> at send time</td>
</tr>
<tr>
<td><strong>Implementation</strong></td>
<td>Expand email template with full report HTML</td>
</tr>
</tbody>
</table>
<h3 id="option-3-azure-blob-storage">Option 3: Azure Blob Storage</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage</strong></td>
<td>Azure Blob container <code>reports</code></td>
</tr>
<tr>
<td><strong>URL</strong></td>
<td><code>https://eislawstorage.blob.core.windows.net/reports/{token}.html</code></td>
</tr>
<tr>
<td><strong>Optional</strong></td>
<td>Custom domain: <code>reports.eislaw.co.il/{token}</code></td>
</tr>
<tr>
<td><strong>Lifecycle</strong></td>
<td>Auto-delete after 30/60/90 days (configurable)</td>
</tr>
<tr>
<td><strong>Data source</strong></td>
<td>HTML/PDF file generated from <code>privacy_submissions</code></td>
</tr>
</tbody>
</table>
<h3 id="storage-cost-estimate-azure-blob">Storage Cost Estimate (Azure Blob)</h3>
<table>
<thead>
<tr>
<th>Volume</th>
<th>Storage</th>
<th>Access</th>
<th>Monthly Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>100 reports/month</td>
<td>~50 MB</td>
<td>500 reads</td>
<td>~$0.01</td>
</tr>
<tr>
<td>1,000 reports/month</td>
<td>~500 MB</td>
<td>5,000 reads</td>
<td>~$0.10</td>
</tr>
<tr>
<td>10,000 reports/month</td>
<td>~5 GB</td>
<td>50,000 reads</td>
<td>~$1.00</td>
</tr>
</tbody>
</table>
<p><strong>Decision pending from CEO.</strong> See <code>PRIVACY_FEATURES_SPEC.md</code> â†’ "Report Delivery Options" for full comparison.</p>
<hr />
<h2 id="tasks-storage-json">Tasks Storage (JSON)</h2>
<p><strong>Location:</strong> <code>~/.eislaw/store/tasks.json</code> (Docker: <code>/home/azureuser/.eislaw/store/tasks.json</code>)
<strong>Type:</strong> JSON array of task objects</p>
<h3 id="task-object-schema">Task Object Schema</h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;title&quot;: &quot;××©×™××” ×œ×“×•×’××”&quot;,
  &quot;desc&quot;: &quot;×ª×™××•×¨ ×”××©×™××”&quot;,
  &quot;status&quot;: &quot;new|in_progress|done&quot;,
  &quot;priority&quot;: &quot;low|medium|high&quot;,
  &quot;dueAt&quot;: &quot;2025-12-10T00:00:00Z&quot;,
  &quot;clientName&quot;: &quot;×©× ×”×œ×§×•×—&quot;,
  &quot;clientFolderPath&quot;: &quot;/path/to/folder&quot;,
  &quot;ownerId&quot;: &quot;user-id&quot;,
  &quot;parentId&quot;: &quot;parent-task-id&quot;,
  &quot;source&quot;: &quot;manual|email|subtask|agent&quot;,
  &quot;comments&quot;: [],
  &quot;attachments&quot;: [],
  &quot;templateRef&quot;: &quot;template-id&quot;,
  &quot;createdAt&quot;: &quot;2025-12-05T16:15:49Z&quot;,
  &quot;updatedAt&quot;: &quot;2025-12-05T16:15:49Z&quot;,
  &quot;doneAt&quot;: null,
  &quot;deletedAt&quot;: null
}
</code></pre>
<h3 id="task-attachments">Task Attachments (× ×›×¡×™× ××©×•×™×›×™×)</h3>
<p>The <code>attachments</code> array holds all assets linked to a task. Each asset has a <code>kind</code> field:</p>
<h4 id="email-attachment">Email Attachment</h4>
<pre><code class="language-json">{
  &quot;kind&quot;: &quot;email&quot;,
  &quot;id&quot;: &quot;AAMkAGI...&quot;,              // Microsoft Graph message ID
  &quot;subject&quot;: &quot;×”×¡×›× ×©×™×¨×•×ª×™×&quot;,
  &quot;from&quot;: &quot;client@example.com&quot;,
  &quot;received&quot;: &quot;2025-12-05T10:30:00Z&quot;,
  &quot;has_attachments&quot;: true,
  &quot;attachments_count&quot;: 2,
  &quot;client_name&quot;: &quot;×œ×§×•×— ×“×•×’××”&quot;,
  &quot;task_title&quot;: &quot;××©×™××” ×××™××™×™×œ&quot;,
  &quot;attached_at&quot;: &quot;2025-12-06T14:20:00Z&quot;
}
</code></pre>
<p><strong>Note:</strong> Only metadata is stored. Actual email content stays in Outlook/Graph API.</p>
<h4 id="link-attachment">Link Attachment</h4>
<pre><code class="language-json">{
  &quot;kind&quot;: &quot;link&quot;,
  &quot;web_url&quot;: &quot;https://example.com/document&quot;,
  &quot;user_title&quot;: &quot;××¡××š ×—×©×•×‘&quot;
}
</code></pre>
<h4 id="folder-attachment">Folder Attachment</h4>
<pre><code class="language-json">{
  &quot;kind&quot;: &quot;folder&quot;,
  &quot;local_path&quot;: &quot;C:\\Users\\...\\ClientFolder&quot;
}
</code></pre>
<h4 id="file-attachment-not-yet-implemented">File Attachment (âš ï¸ NOT YET IMPLEMENTED)</h4>
<pre><code class="language-json">{
  &quot;kind&quot;: &quot;file&quot;,
  &quot;drive_id&quot;: &quot;sharepoint-item-id&quot;,
  &quot;source_name&quot;: &quot;contract.pdf&quot;,
  &quot;user_title&quot;: &quot;×”×¡×›× ×©×™×¨×•×ª&quot;
}
</code></pre>
<p><strong>Status:</strong> Frontend button exists, backend endpoint missing. Files should be uploaded to SharePoint.</p>
<h3 id="api-endpoints-for-tasks">API Endpoints for Tasks</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/tasks</code></td>
<td>GET</td>
<td>List all tasks</td>
</tr>
<tr>
<td><code>/api/tasks</code></td>
<td>POST</td>
<td>Create task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}</code></td>
<td>PATCH</td>
<td>Update task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}</code></td>
<td>DELETE</td>
<td>Delete task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}/done</code></td>
<td>POST</td>
<td>Mark task done</td>
</tr>
<tr>
<td><code>/tasks/{id}/files</code></td>
<td>GET</td>
<td>Get task attachments</td>
</tr>
<tr>
<td><code>/tasks/{id}/emails/attach</code></td>
<td>POST</td>
<td>Attach email to task</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="2-email-database-email_indexsqlite">2. Email Database: <code>email_index.sqlite</code></h3>
<p><strong>Location:</strong> <code>clients/email_index.sqlite</code>
<strong>Purpose:</strong> Fast email search (FTS5) without hitting Graph API
<strong>Created by:</strong> <code>tools/email_catalog.py</code>
<strong>Justification:</strong> Separate DB warranted - different data lifecycle, 24MB, FTS5 specialized</p>
<pre><code class="language-sql">-- Messages index
CREATE TABLE messages (
    id TEXT PRIMARY KEY,
    thread_id TEXT,
    client TEXT,
    client_path TEXT,
    received TEXT,
    subject TEXT,
    from_addr TEXT,
    to_addrs TEXT,
    cc_addrs TEXT,
    json_path TEXT,   -- Path to full JSON content
    eml_path TEXT
);

-- Full-text search
CREATE VIRTUAL TABLE messages_fts USING fts5(
    id, subject, body
);
</code></pre>
<hr />
<h2 id="external-services">External Services</h2>
<table>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
<th>Access Method</th>
<th>Auth</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Microsoft Graph</strong></td>
<td>Emails, Calendar, SharePoint</td>
<td>REST API</td>
<td>OAuth app token</td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Meilisearch</strong></td>
<td>RAG semantic search</td>
<td>HTTP :7700</td>
<td>API key</td>
<td>âœ… Active</td>
</tr>
<tr>
<td><strong>Airtable</strong></td>
<td>Contact list source (batch sync)</td>
<td>REST API</td>
<td>API key</td>
<td>ğŸ”„ In Progress (SQLite sink ready)</td>
</tr>
</tbody>
</table>
<h3 id="airtable-integration-new-architecture-2025-12-07">Airtable Integration - NEW ARCHITECTURE (2025-12-07)</h3>
<blockquote>
<p><strong>IMPORTANT:</strong> Architecture changed per CEO decision. See <code>ARCHITECTURE_DECISIONS.md</code> â†’ AD-001.</p>
</blockquote>
<p><strong>Previous Design:</strong> Airtable = Source of Truth (bidirectional real-time sync)
<strong>New Design:</strong> SQLite = Source of Truth (bidirectional batch sync)</p>
<h4 id="architecture-overview">Architecture Overview</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AIRTABLE     â”‚ â†â”€â”€â”€â”€â”€ Batch â”€â”€â”€â”€â”€â”€â†’ â”‚     SQLITE      â”‚
â”‚ (Contact List)  â”‚        Sync          â”‚ (Source of Truth)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="two-data-sets-in-ui">Two Data Sets in UI</h4>
<table>
<thead>
<tr>
<th>Tab</th>
<th>Table</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>×¨×©×™××ª ×§×©×¨</strong></td>
<td><code>airtable_contacts</code></td>
<td>All contacts from Airtable (potential clients)</td>
</tr>
<tr>
<td><strong>×œ×§×•×—×•×ª</strong></td>
<td><code>clients</code></td>
<td>Active clients with folders, tasks, emails</td>
</tr>
</tbody>
</table>
<h4 id="sync-endpoints-to-build">Sync Endpoints (TO BUILD)</h4>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Direction</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>POST /api/sync/pull-airtable</code></td>
<td>Airtable â†’ SQLite</td>
<td>Pull all contacts from Airtable</td>
</tr>
<tr>
<td><code>POST /api/sync/push-airtable</code></td>
<td>SQLite â†’ Airtable</td>
<td>Push local changes (contacts, links)</td>
</tr>
<tr>
<td><code>POST /api/contacts/activate</code></td>
<td>Internal</td>
<td>Move contact to active clients</td>
</tr>
<tr>
<td><code>GET /api/airtable-contacts</code></td>
<td>Read</td>
<td>List all synced contacts</td>
</tr>
</tbody>
</table>
<h4 id="activation-flow">Activation Flow</h4>
<ol>
<li>User sees contact in "×¨×©×™××ª ×§×©×¨" tab</li>
<li>Clicks "×¤×ª×— ×ª×™×§×™×™×”" (Open Folder)</li>
<li>Contact copied to <code>clients</code> table with folder setup</li>
<li>Now appears in "×œ×§×•×—×•×ª" tab with full functionality</li>
</ol>
<h4 id="conflict-resolution">Conflict Resolution</h4>
<p><strong>SQLite wins.</strong> If same field edited in both places, SQLite value overwrites Airtable on next push.</p>
<p><strong>Base:</strong> EISLAW CRM
<strong>Tables:</strong> ×œ×§×•×—×•×ª (Clients), ×× ×©×™ ×§×©×¨ (Contacts)</p>
<hr />
<h2 id="airtable-schema-complete-field-reference">Airtable Schema (Complete Field Reference)</h2>
<p><strong>Purpose:</strong> This section provides the authoritative Airtable field mapping for:
- <strong>Joseph:</strong> JSON â†’ SQLite migration (field name mapping)
- <strong>Alex:</strong> Building <code>/airtable/*</code> endpoints (API integration)
- <strong>AI Agents:</strong> Understanding authoritative field names and types</p>
<p><strong>Reference:</strong> Full schema in <code>docs/Airtable_Schema.md</code></p>
<h3 id="base-configuration">Base Configuration</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Base ID</strong></td>
<td><code>appv3nlRQTtsk97Y5</code></td>
</tr>
<tr>
<td><strong>Base Name</strong></td>
<td>EISLAW CRM</td>
</tr>
</tbody>
</table>
<p><strong>Secrets Location:</strong> <code>secrets.local.json</code> â†’ <code>airtable</code> object</p>
<pre><code class="language-json">{
  &quot;airtable&quot;: {
    &quot;token&quot;: &quot;...&quot;,
    &quot;base_id&quot;: &quot;appv3nlRQTtsk97Y5&quot;,
    &quot;clients_table&quot;: &quot;×œ×§×•×—×•×ª&quot;,
    &quot;contacts_table&quot;: &quot;×× ×©×™ ×§×©×¨&quot;,
    &quot;view_clients&quot;: &quot;viw34b0ytkGoQd1n3&quot;,
    &quot;view_contacts&quot;: &quot;viwDZcPYwOkY2bm1g&quot;
  }
}
</code></pre>
<hr />
<h3 id="table-1-clients-tblokuygteedm76nm">Table 1: Clients (<code>tbloKUYGtEEdM76Nm</code> / <code>×œ×§×•×—×•×ª</code>)</h3>
<p><strong>View ID:</strong> <code>viw34b0ytkGoQd1n3</code> (Clients â€“ Default)</p>
<h4 id="complete-field-mapping">Complete Field Mapping</h4>
<table>
<thead>
<tr>
<th>Airtable Field (Hebrew)</th>
<th>Field ID</th>
<th>Type</th>
<th>SQLite Column</th>
<th>Sync Direction</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>×œ×§×•×—×•×ª</code></td>
<td><code>fldA0Y2J3RDVj7tXK</code></td>
<td>singleLineText</td>
<td><code>name</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Primary display name</td>
</tr>
<tr>
<td><code>××¡×¤×¨ ×˜×œ×¤×•×Ÿ</code></td>
<td><code>fldMIJHcN2l5ejhR7</code></td>
<td>phoneNumber</td>
<td><code>phone</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Primary phone</td>
</tr>
<tr>
<td><code>××™××™×™×œ</code></td>
<td><code>fldP7dNeIQjMPuAHc</code></td>
<td>email</td>
<td><code>email</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Array in API, use <code>[0]</code></td>
</tr>
<tr>
<td><code>×¡×•×’ ×œ×§×•×—</code></td>
<td><code>fldFJ6OyN2iAJmORr</code></td>
<td>multipleSelects</td>
<td><code>types</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>JSON array of tags</td>
</tr>
<tr>
<td><code>×‘×˜×™×¤×•×œ</code></td>
<td><code>fldEKRIZpCerjVGn0</code></td>
<td>singleSelect</td>
<td><code>stage</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Current status</td>
</tr>
<tr>
<td><code>×”×¢×¨×•×ª</code></td>
<td><code>fldTylMnpZOJWALOA</code></td>
<td>multilineText</td>
<td><code>notes</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Internal notes</td>
</tr>
<tr>
<td><code>×•×•×¦××¤</code></td>
<td><code>fldtjYZSWJhPIRlio</code></td>
<td>button</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Object: <code>{label, url}</code></td>
</tr>
<tr>
<td><code>××™×™×œ ×ª×™××•× ×¤×’×™×©×”</code></td>
<td><code>fld96QoxyYGzIwZQJ</code></td>
<td>button</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Mailto link</td>
</tr>
<tr>
<td><code>Calculation</code></td>
<td><code>fldUnoPV82lWZkAX2</code></td>
<td>formula</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Fillout intake link</td>
</tr>
<tr>
<td><code>fillout formula</code></td>
<td><code>fldgfiFtvXqEptjp0</code></td>
<td>formula</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Prefilled URL</td>
</tr>
<tr>
<td><code>×ª×™×§×™× ×•×¤×¨×•×™×™×§×˜×™× 2</code></td>
<td><code>fldzoqZgLzznBMeKd</code></td>
<td>multipleRecordLinks</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Project links</td>
</tr>
<tr>
<td><code>×× ×©×™ ×§×©×¨ × ×•×¡×¤×™×</code></td>
<td><code>fldk5RInnAcMQhZYi</code></td>
<td>multipleRecordLinks</td>
<td>-</td>
<td>â†”ï¸ Via contacts table</td>
<td>Array of contact record IDs</td>
</tr>
<tr>
<td><code>×× ×©×™ ×§×©×¨ × ×•×¡×¤×™× 2</code></td>
<td><code>fldVGJIrjpnnxsGNM</code></td>
<td>multipleRecordLinks</td>
<td>-</td>
<td>â†”ï¸ Via contacts table</td>
<td>Array of contact record IDs</td>
</tr>
<tr>
<td><code>×›×¡×¤×™×</code></td>
<td><code>fldZDaB3ZrCj5uWIJ</code></td>
<td>multipleRecordLinks</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Finance references</td>
</tr>
<tr>
<td><code>×ª×©×œ×•××™×</code></td>
<td><code>fldgiKG8RppPZZCHJ</code></td>
<td>singleLineText</td>
<td>-</td>
<td>â†’ Read Only</td>
<td>Payment notes</td>
</tr>
<tr>
<td><code>Created</code></td>
<td><code>fldBBrJ4mIDyf3xCZ</code></td>
<td>createdTime</td>
<td><code>created_at</code></td>
<td>â†’ Read Only</td>
<td>System metadata</td>
</tr>
<tr>
<td><code>Last Modified</code></td>
<td><code>fldbZVWx5QOm4Rtej</code></td>
<td>lastModifiedTime</td>
<td><code>updated_at</code></td>
<td>â†’ Read Only</td>
<td>System metadata</td>
</tr>
</tbody>
</table>
<h4 id="field-normalization-rules">Field Normalization Rules</h4>
<p>When reading from Airtable API, normalize field names as follows:</p>
<table>
<thead>
<tr>
<th>Normalized Key</th>
<th>Airtable Field(s)</th>
<th>Transform Rule</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>×œ×§×•×—×•×ª</code>, <code>Name</code>, <code>Client</code></td>
<td>Use first non-empty value</td>
</tr>
<tr>
<td><code>email</code></td>
<td><code>××™××™×™×œ</code></td>
<td>Extract <code>[0]</code> from array</td>
</tr>
<tr>
<td><code>phone</code></td>
<td><code>××¡×¤×¨ ×˜×œ×¤×•×Ÿ</code></td>
<td>Use as-is</td>
</tr>
<tr>
<td><code>types</code></td>
<td><code>×¡×•×’ ×œ×§×•×—</code></td>
<td>JSON array of strings</td>
</tr>
<tr>
<td><code>stage</code></td>
<td><code>×‘×˜×™×¤×•×œ</code></td>
<td>Single select value</td>
</tr>
<tr>
<td><code>notes</code></td>
<td><code>×”×¢×¨×•×ª</code>, <code>× ×ª×•× ×™× ××©×¤×˜×™</code></td>
<td>Concatenate if multiple</td>
</tr>
<tr>
<td><code>whatsapp_url</code></td>
<td><code>×•×•×¦××¤.url</code></td>
<td>Extract <code>url</code> from button object</td>
</tr>
<tr>
<td><code>meeting_email_url</code></td>
<td><code>××™×™×œ ×ª×™××•× ×¤×’×™×©×”.url</code></td>
<td>Extract <code>url</code> from button object</td>
</tr>
<tr>
<td><code>airtable_id</code></td>
<td>-</td>
<td>Use Airtable record ID (e.g., <code>rec0CKdM2lTytvxHY</code>)</td>
</tr>
</tbody>
</table>
<h4 id="sqlite-airtable-field-mapping">SQLite â†’ Airtable Field Mapping</h4>
<table>
<thead>
<tr>
<th>SQLite Column</th>
<th>Airtable Field</th>
<th>API Type</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>-</td>
<td>-</td>
<td>Generated locally (UUID)</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>×œ×§×•×—×•×ª</code></td>
<td>string</td>
<td>Required</td>
</tr>
<tr>
<td><code>email</code></td>
<td><code>××™××™×™×œ</code></td>
<td>array[string]</td>
<td>Email format</td>
</tr>
<tr>
<td><code>phone</code></td>
<td><code>××¡×¤×¨ ×˜×œ×¤×•×Ÿ</code></td>
<td>string</td>
<td>Phone format</td>
</tr>
<tr>
<td><code>stage</code></td>
<td><code>×‘×˜×™×¤×•×œ</code></td>
<td>string</td>
<td>Single select</td>
</tr>
<tr>
<td><code>types</code></td>
<td><code>×¡×•×’ ×œ×§×•×—</code></td>
<td>array[string]</td>
<td>Multiple select</td>
</tr>
<tr>
<td><code>notes</code></td>
<td><code>×”×¢×¨×•×ª</code></td>
<td>string</td>
<td>Long text</td>
</tr>
<tr>
<td><code>airtable_id</code></td>
<td>record ID</td>
<td>string</td>
<td>Read-only (e.g., <code>recXXXX</code>)</td>
</tr>
<tr>
<td><code>airtable_url</code></td>
<td>-</td>
<td>string</td>
<td>Construct from base + record ID</td>
</tr>
<tr>
<td><code>sharepoint_url</code></td>
<td>-</td>
<td>string</td>
<td>Local only, not in Airtable</td>
</tr>
<tr>
<td><code>local_folder</code></td>
<td>-</td>
<td>string</td>
<td>Local only, not in Airtable</td>
</tr>
<tr>
<td><code>active</code></td>
<td>-</td>
<td>integer</td>
<td>Local only (filter flag)</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td><code>Created</code></td>
<td>datetime</td>
<td>ISO 8601</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td><code>Last Modified</code></td>
<td>datetime</td>
<td>ISO 8601</td>
</tr>
<tr>
<td><code>last_synced_at</code></td>
<td>-</td>
<td>datetime</td>
<td>Local only (sync tracking)</td>
</tr>
<tr>
<td><code>sync_source</code></td>
<td>-</td>
<td>string</td>
<td>Local only (<code>'airtable'</code> or <code>'manual'</code>)</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="table-2-contacts-tblwvzn9vjogjdwrx">Table 2: Contacts (<code>tblWVZn9VjoGjdWrX</code> / <code>×× ×©×™ ×§×©×¨</code>)</h3>
<p><strong>View ID:</strong> <code>viwDZcPYwOkY2bm1g</code> (Contacts â€“ Default)</p>
<h4 id="complete-field-mapping_1">Complete Field Mapping</h4>
<table>
<thead>
<tr>
<th>Airtable Field (Hebrew)</th>
<th>Field ID</th>
<th>Type</th>
<th>SQLite Column</th>
<th>Sync Direction</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>×©× ××™×© ×§×©×¨</code></td>
<td><code>fldZu8x9X6LRcsw2y</code></td>
<td>singleLineText</td>
<td><code>name</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Contact name</td>
</tr>
<tr>
<td><code>××™×™×œ</code></td>
<td><code>fldp7jqCjLtgxzehD</code></td>
<td>email</td>
<td><code>email</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Contact email</td>
</tr>
<tr>
<td><code>×˜×œ×¤×•×Ÿ</code></td>
<td><code>fldl7uEqAbz36c3FL</code></td>
<td>phoneNumber</td>
<td><code>phone</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Contact phone</td>
</tr>
<tr>
<td><code>×œ×§×•×—</code></td>
<td><code>fldqjVZWpQjavy0Lm</code></td>
<td>multipleRecordLinks</td>
<td><code>client_id</code></td>
<td>â†”ï¸ Bidirectional</td>
<td>Linked client (use <code>[0]</code>)</td>
</tr>
<tr>
<td><code>××¡×¤×¨ ×–×™×”×•×™</code></td>
<td><code>fld0kF1wQ9tn2RnOq</code></td>
<td>singleLineText</td>
<td>-</td>
<td>â†”ï¸ Bidirectional</td>
<td>ID number (optional)</td>
</tr>
<tr>
<td><code>×›×ª×•×‘×ª</code></td>
<td><code>fld0Gf8H8qT0xmwzN</code></td>
<td>multilineText</td>
<td>-</td>
<td>â†”ï¸ Bidirectional</td>
<td>Address (optional)</td>
</tr>
</tbody>
</table>
<h4 id="sqlite-airtable-field-mapping-contacts">SQLite â†’ Airtable Field Mapping (Contacts)</h4>
<table>
<thead>
<tr>
<th>SQLite Column</th>
<th>Airtable Field</th>
<th>API Type</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>-</td>
<td>-</td>
<td>Generated locally (UUID)</td>
</tr>
<tr>
<td><code>client_id</code></td>
<td><code>×œ×§×•×—</code></td>
<td>array[string]</td>
<td>FK to clients.id, maps to Airtable record ID</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>×©× ××™×© ×§×©×¨</code></td>
<td>string</td>
<td>Required</td>
</tr>
<tr>
<td><code>email</code></td>
<td><code>××™×™×œ</code></td>
<td>string</td>
<td>Email format</td>
</tr>
<tr>
<td><code>phone</code></td>
<td><code>×˜×œ×¤×•×Ÿ</code></td>
<td>string</td>
<td>Phone format</td>
</tr>
<tr>
<td><code>role</code></td>
<td>-</td>
<td>string</td>
<td>Local only (not in Airtable yet)</td>
</tr>
<tr>
<td><code>notes</code></td>
<td><code>×›×ª×•×‘×ª</code></td>
<td>string</td>
<td>Mapped to address field</td>
</tr>
<tr>
<td><code>created_at</code></td>
<td>-</td>
<td>datetime</td>
<td>Local only</td>
</tr>
<tr>
<td><code>updated_at</code></td>
<td>-</td>
<td>datetime</td>
<td>Local only</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> The <code>is_primary</code> flag exists in SQLite but NOT in Airtable. This is a local-only field for UI purposes.</p>
<hr />
<h3 id="sync-direction-rules">Sync Direction Rules</h3>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Meaning</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td>â†”ï¸</td>
<td><strong>Bidirectional</strong></td>
<td>Changes in either system sync to the other</td>
</tr>
<tr>
<td>â†’</td>
<td><strong>Read Only</strong></td>
<td>Only sync FROM Airtable TO SQLite</td>
</tr>
<tr>
<td>â†</td>
<td><strong>Write Only</strong></td>
<td>Only sync FROM SQLite TO Airtable</td>
</tr>
</tbody>
</table>
<h4 id="sync-behavior">Sync Behavior</h4>
<ol>
<li><strong>Airtable â†’ SQLite (Import/Pull)</strong></li>
<li>Triggered by: User clicks "Sync from Airtable" OR <code>/airtable/search</code> endpoint</li>
<li>Fields synced: All bidirectional + read-only fields</li>
<li>
<p>Conflict resolution: Airtable wins (overwrites local)</p>
</li>
<li>
<p><strong>SQLite â†’ Airtable (Export/Push)</strong></p>
</li>
<li>Triggered by: User saves client in AddClientModal OR <code>/airtable/clients_upsert</code> endpoint</li>
<li>Fields synced: Only bidirectional fields (excludes read-only formulas/buttons)</li>
<li>
<p>Conflict resolution: Last-write wins (use <code>Last Modified</code> timestamp)</p>
</li>
<li>
<p><strong>Local-Only Fields (Never Sync)</strong></p>
</li>
<li><code>sharepoint_url</code>, <code>local_folder</code>, <code>active</code>, <code>last_synced_at</code>, <code>sync_source</code></li>
<li>These exist only in SQLite for local app functionality</li>
</ol>
<h4 id="contact-linking">Contact Linking</h4>
<p>Airtable uses <strong>linked records</strong> for contacts. The flow is:</p>
<ol>
<li>
<p><strong>Reading Contacts:</strong>
   <code>Client record â†’ fields['×× ×©×™ ×§×©×¨ × ×•×¡×¤×™×'] = ['recAAA', 'recBBB']
   For each ID â†’ GET /v0/{base_id}/×× ×©×™ ×§×©×¨/{record_id}
   Extract: {name, email, phone} â†’ Store in SQLite contacts table</code></p>
</li>
<li>
<p><strong>Creating Contacts:</strong>
   <code>Local: Create contact in SQLite with client_id
   Airtable: POST /v0/{base_id}/×× ×©×™ ×§×©×¨ with fields={'×œ×§×•×—': [client_airtable_id]}
   Update: Add returned record ID to client's '×× ×©×™ ×§×©×¨ × ×•×¡×¤×™×' field</code></p>
</li>
</ol>
<hr />
<h3 id="data-integrity-rules">Data Integrity Rules</h3>
<ol>
<li><strong>Airtable is Source of Truth</strong></li>
<li>For client master data (name, email, phone, stage)</li>
<li>
<p>In case of conflict, Airtable data wins</p>
</li>
<li>
<p><strong>SQLite is Source of Truth</strong></p>
</li>
<li>For local-only fields (folders, sync state)</li>
<li>
<p>For AI agent access (agents can't call Airtable directly)</p>
</li>
<li>
<p><strong>Mandatory Fields (Both Systems)</strong></p>
</li>
<li>Client: <code>name</code> (required in both)</li>
<li>
<p>Contact: <code>name</code>, <code>client_id</code> (required in both)</p>
</li>
<li>
<p><strong>Email Field Special Case</strong></p>
</li>
<li>Airtable stores as array: <code>["email@example.com"]</code></li>
<li>SQLite stores as string: <code>"email@example.com"</code></li>
<li>
<p>Transform: Use <code>email[0]</code> when reading, <code>[email]</code> when writing</p>
</li>
<li>
<p><strong>Sync State Tracking</strong></p>
</li>
<li><code>last_synced_at</code>: Timestamp of last successful sync</li>
<li><code>sync_source</code>: <code>'airtable'</code> (imported) or <code>'manual'</code> (created locally)</li>
<li>Use to determine if client needs push/pull</li>
</ol>
<hr />
<h3 id="api-endpoints-airtable-integration">API Endpoints (Airtable Integration)</h3>
<p><strong>Implemented:</strong>
- None (all missing)</p>
<p><strong>Required (P1 - Blocking):</strong></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
<th>Uses Airtable API</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/airtable/search</code></td>
<td>GET</td>
<td>Smart search Airtable for clients</td>
<td>Yes - List records with filter</td>
</tr>
<tr>
<td><code>/registry/clients</code></td>
<td>POST</td>
<td>Save client to local SQLite</td>
<td>No - Local only</td>
</tr>
<tr>
<td><code>/airtable/clients_upsert</code></td>
<td>POST</td>
<td>Push client changes to Airtable</td>
<td>Yes - PATCH record</td>
</tr>
</tbody>
</table>
<p><strong>See:</strong> <code>API_ENDPOINTS_INVENTORY.md</code> for full endpoint specs</p>
<hr />
<h3 id="migration-status-complete-2025-12-06">Migration Status - âœ… COMPLETE (2025-12-06)</h3>
<p><strong>Completed by:</strong> Joseph (Database Developer)
<strong>Date:</strong> 2025-12-06
<strong>Verified by:</strong> Joe (CTO) - Skeptical Review passed</p>
<h4 id="what-was-done">What Was Done</h4>
<table>
<thead>
<tr>
<th>Task</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Switch <code>load_local_clients()</code> to use SQLite</td>
<td>âœ… Done</td>
</tr>
<tr>
<td>Switch <code>find_local_client()</code> to use SQLite</td>
<td>âœ… Done</td>
</tr>
<tr>
<td>Add <code>slug</code> &amp; <code>sharepoint_id</code> columns</td>
<td>âœ… Done</td>
</tr>
<tr>
<td>Verify all JSON clients exist in SQLite</td>
<td>âœ… Done (13 clients)</td>
</tr>
<tr>
<td>Contacts properly joined from SQLite</td>
<td>âœ… Done (12 contacts)</td>
</tr>
</tbody>
</table>
<h4 id="current-state">Current State</h4>
<table>
<thead>
<tr>
<th>Component</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Backend reads from</strong></td>
<td>âœ… SQLite (<code>data/eislaw.db â†’ clients</code>)</td>
</tr>
<tr>
<td><strong>JSON file</strong></td>
<td>âš ï¸ DEPRECATED (<code>~/.eislaw/store/clients.json</code>)</td>
</tr>
<tr>
<td><strong>Contacts</strong></td>
<td>âœ… Joined from <code>contacts</code> table</td>
</tr>
<tr>
<td><strong>Airtable</strong></td>
<td>Remote sync source (endpoints TBD)</td>
</tr>
</tbody>
</table>
<h4 id="verification-results">Verification Results</h4>
<pre><code>API Test: GET /api/clients
- Clients returned: 12 (1 &quot;ZZZ Test&quot; filtered)
- Contacts embedded: 10
- Source: SQLite âœ…
</code></pre>
<h4 id="field-mapping-reference">Field Mapping Reference</h4>
<table>
<thead>
<tr>
<th>SQLite Column</th>
<th>Airtable Field</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>-</td>
<td>Local UUID</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>×œ×§×•×—×•×ª</code></td>
<td>Primary field</td>
</tr>
<tr>
<td><code>email</code></td>
<td><code>××™××™×™×œ[0]</code></td>
<td>Extract from array</td>
</tr>
<tr>
<td><code>phone</code></td>
<td><code>××¡×¤×¨ ×˜×œ×¤×•×Ÿ</code></td>
<td>Direct mapping</td>
</tr>
<tr>
<td><code>stage</code></td>
<td><code>×‘×˜×™×¤×•×œ</code></td>
<td>Single select</td>
</tr>
<tr>
<td><code>types</code></td>
<td><code>×¡×•×’ ×œ×§×•×—</code></td>
<td>JSON array</td>
</tr>
<tr>
<td><code>notes</code></td>
<td><code>×”×¢×¨×•×ª</code></td>
<td>Long text</td>
</tr>
<tr>
<td><code>airtable_id</code></td>
<td>record ID</td>
<td>e.g., <code>rec0CKdM...</code></td>
</tr>
</tbody>
</table>
<p><strong>See:</strong> <code>TASK_JOSEPH_CLIENT_REGISTRY_MIGRATION.md</code> for full migration details</p>
<hr />
<h2 id="data-flow-diagrams">Data Flow Diagrams</h2>
<h3 id="email-flow">Email Flow</h3>
<pre><code>Outlook Mailbox
      â”‚
      â–¼ (Graph API sync)
JSON Files (clients/*/emails/*.json)
      â”‚
      â–¼ (email_catalog.py)
email_index.sqlite (search index)
      â”‚
      â–¼ (API endpoints)
Frontend / AI Agents
</code></pre>
<h3 id="client-data-flow">Client Data Flow</h3>
<h4 id="full-client-sync-flow">Full Client Sync Flow</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AIRTABLE                                â”‚
â”‚                    (Source of Truth)                            â”‚
â”‚      Base: EISLAW CRM â†’ Table: ×œ×§×•×—×•×ª (Clients)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ (1) /airtable/search - Smart search
                              â”‚    (âŒ Backend Missing)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AddClientModal (Frontend)                     â”‚
â”‚    - User searches for client name                              â”‚
â”‚    - Shows matches from Airtable                                â”‚
â”‚    - User can import or create new                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ (2) /registry/clients POST - Save
                              â”‚    (âŒ Backend Missing)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      eislaw.db â†’ clients                        â”‚
â”‚                     (Local SQLite Copy)                         â”‚
â”‚    - id, name, email, phone, stage, types                       â”‚
â”‚    - airtable_id, airtable_url (link back to source)            â”‚
â”‚    - sharepoint_url, local_folder (document locations)          â”‚
â”‚    - sync_source = 'airtable' | 'manual'                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ (3) /airtable/clients_upsert - Sync back
                              â”‚    (âŒ Backend Missing)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AIRTABLE                                â”‚
â”‚              (Changes synced back to Airtable)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="data-sources-for-addclientmodal">Data Sources for AddClientModal</h4>
<table>
<thead>
<tr>
<th>Source</th>
<th>Endpoint</th>
<th>Purpose</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Airtable search</td>
<td><code>/airtable/search</code></td>
<td>Find existing clients</td>
<td>âŒ Missing</td>
</tr>
<tr>
<td>Local DB</td>
<td><code>/api/clients</code></td>
<td>List local clients</td>
<td>âœ…</td>
</tr>
<tr>
<td>Client summary</td>
<td><code>/api/client/summary</code></td>
<td>Get folder/SP links</td>
<td>âœ…</td>
</tr>
<tr>
<td>Save client</td>
<td><code>/registry/clients</code></td>
<td>Save to local DB</td>
<td>âŒ Missing</td>
</tr>
<tr>
<td>Sync to Airtable</td>
<td><code>/airtable/clients_upsert</code></td>
<td>Push to Airtable</td>
<td>âŒ Missing</td>
</tr>
</tbody>
</table>
<h4 id="airtable-integration-status-partially-implemented">Airtable Integration Status: âš ï¸ PARTIALLY IMPLEMENTED</h4>
<ul>
<li><strong>Frontend:</strong> Fully coded (AddClientModal has all fetch calls)</li>
<li><strong>Backend:</strong> Missing endpoints (see API_ENDPOINTS_INVENTORY.md)</li>
<li><strong>Result:</strong> Smart search and sync features silently fail</li>
</ul>
<h4 id="legacy-note">Legacy Note</h4>
<p>Airtable was the original CRM. Local SQLite copy was added for:
- Offline access
- Faster queries
- AI Agent access (agents can't call Airtable directly)</p>
<p>The sync flow should be bidirectional but backend endpoints are missing.</p>
<hr />
<h2 id="data-storage-policy">Data Storage Policy</h2>
<h3 id="when-to-use-main-db-eislawdb">When to use Main DB (<code>eislaw.db</code>)</h3>
<ul>
<li>Core business entities (clients, tasks, agents)</li>
<li>Data that needs joins with other tables</li>
<li>Transactional data</li>
<li>User-created records</li>
</ul>
<h3 id="when-to-use-separate-db">When to use Separate DB</h3>
<ul>
<li>Specialized search (FTS5, vector search)</li>
<li>Large datasets with different lifecycle</li>
<li>External sync targets (email index)</li>
<li>Clear isolation benefit</li>
</ul>
<h3 id="when-to-use-files">When to use Files</h3>
<ul>
<li>Raw content from external sources (email JSON)</li>
<li>Configuration</li>
<li>Secrets (never in DB)</li>
</ul>
<h3 id="when-to-use-external-services">When to use External Services</h3>
<ul>
<li>Source of truth lives elsewhere (Outlook, SharePoint)</li>
<li>Specialized capabilities (Meilisearch semantic search)</li>
</ul>
<hr />
<h2 id="api-endpoints-actual">API Endpoints (Actual)</h2>
<h3 id="clients-tasks">Clients &amp; Tasks</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/clients</code></td>
<td>GET</td>
<td>List all clients</td>
</tr>
<tr>
<td><code>/api/clients/{id}</code></td>
<td>GET</td>
<td>Get client details</td>
</tr>
<tr>
<td><code>/api/client/summary</code></td>
<td>GET</td>
<td>Client overview</td>
</tr>
<tr>
<td><code>/api/tasks</code></td>
<td>GET</td>
<td>List all tasks</td>
</tr>
<tr>
<td><code>/api/tasks</code></td>
<td>POST</td>
<td>Create task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}</code></td>
<td>PATCH</td>
<td>Update task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}</code></td>
<td>DELETE</td>
<td>Delete task</td>
</tr>
<tr>
<td><code>/api/tasks/{id}/done</code></td>
<td>POST</td>
<td>Mark task done</td>
</tr>
</tbody>
</table>
<h3 id="emails">Emails</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/email/by_client?name=X</code></td>
<td>GET</td>
<td>Get emails for client (Graph API)</td>
</tr>
<tr>
<td><code>/email/content?id=X</code></td>
<td>GET</td>
<td>Get full email HTML</td>
</tr>
<tr>
<td><code>/email/open</code></td>
<td>POST</td>
<td>Generate Outlook deeplink</td>
</tr>
<tr>
<td><code>/email/sync_client</code></td>
<td>POST</td>
<td>Sync emails for client</td>
</tr>
</tbody>
</table>
<h3 id="quote-templates">Quote Templates</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/quote-templates</code></td>
<td>GET</td>
<td>List templates</td>
</tr>
<tr>
<td><code>/api/quote-templates</code></td>
<td>POST</td>
<td>Create template</td>
</tr>
<tr>
<td><code>/api/quote-templates/{id}</code></td>
<td>GET</td>
<td>Get template</td>
</tr>
<tr>
<td><code>/api/quote-templates/{id}</code></td>
<td>PUT</td>
<td>Update template</td>
</tr>
</tbody>
</table>
<h3 id="agents">Agents</h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/agents</code></td>
<td>GET</td>
<td>List agents</td>
</tr>
<tr>
<td><code>/api/agents/approvals</code></td>
<td>GET</td>
<td>Pending approvals</td>
</tr>
<tr>
<td><code>/api/agents/approvals/{id}</code></td>
<td>POST</td>
<td>Approve/reject</td>
</tr>
</tbody>
</table>
<p><strong>Rule:</strong> Agents use APIs, never direct DB access.</p>
<hr />
<h2 id="maintenance">Maintenance</h2>
<table>
<thead>
<tr>
<th>Task</th>
<th>Frequency</th>
<th>Owner</th>
</tr>
</thead>
<tbody>
<tr>
<td>Backup <code>eislaw.db</code></td>
<td>Daily</td>
<td>Automated</td>
</tr>
<tr>
<td>Rebuild email index</td>
<td>On demand</td>
<td><code>python tools/email_catalog.py</code></td>
</tr>
<tr>
<td>Verify data integrity</td>
<td>Weekly</td>
<td>Joseph</td>
</tr>
<tr>
<td>Update this document</td>
<td>On any data change</td>
<td>CTO approval required</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="change-log">Change Log</h2>
<table>
<thead>
<tr>
<th>Date</th>
<th>Change</th>
<th>By</th>
</tr>
</thead>
<tbody>
<tr>
<td>2025-12-06</td>
<td>Created Data Bible</td>
<td>Joe (CTO)</td>
</tr>
<tr>
<td>2025-12-06</td>
<td><strong>Major Update:</strong> Added 8 missing tables (contacts, quote_templates, agent_*, activity_log, sync_state). Fixed API endpoints. Added actual schema from production DB.</td>
<td>Joe (CTO)</td>
</tr>
<tr>
<td>2025-12-06</td>
<td><strong>CORRECTION:</strong> Tasks are stored in JSON file (<code>~/.eislaw/store/tasks.json</code>), NOT SQLite. Added full Task Attachments documentation (email, link, folder, file types). Documented attachment APIs.</td>
<td>Joe (CTO)</td>
</tr>
<tr>
<td>2025-12-06</td>
<td><strong>AIRTABLE SCHEMA ADDED:</strong> Complete field reference for Clients and Contacts tables. Includes: Base/Table IDs, field mappings (Airtable â†” SQLite), sync direction rules, normalization rules, data integrity rules, contact linking flow, and migration notes for Joseph.</td>
<td>David (Product)</td>
</tr>
<tr>
<td>2025-12-06</td>
<td><strong>MIGRATION COMPLETE:</strong> JSON â†’ SQLite migration done by Joseph. Backend now reads from SQLite. Updated Migration Notes section to reflect completed status. Verified by CTO skeptical review.</td>
<td>Joseph (Database) + Joe (CTO)</td>
</tr>
<tr>
<td>2025-12-07</td>
<td><strong>RAG SCHEMA ADDED:</strong> Added 3 new tables for RAG module (recordings, transcripts, rag_documents). Migrated 32 recordings from <code>recordings_cache.json</code> and 32 transcripts from <code>RAG_Pilot/transcripts/*.txt</code> to SQLite. Total database tables: 11 â†’ 14.</td>
<td>Joseph (Database)</td>
</tr>
<tr>
<td>2025-12-07</td>
<td><strong>PRIVACY DATABASE CONSOLIDATED:</strong> Privacy data now stored in separate <code>privacy.db</code> (not eislaw.db). Single <code>privacy_submissions</code> table with embedded scores (no separate privacy_reviews). Webhook writes to privacy.db, API reads from privacy.db. Fixed database mismatch bug during stress testing. eislaw.db tables: 16 â†’ 14.</td>
<td>Joe (CTO)</td>
</tr>
</tbody>
</table>
<hr />
<p><em>This document requires CTO approval for changes.</em></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
