<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.local/PRD_PRIVACY_PURCHASE_FLOW/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>PRD: Privacy Report Purchase Flow - EISLAW Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">EISLAW Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../INDEX/" class="nav-link">Index</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKING_MEMORY/" class="nav-link">Working Memory</a>
                            </li>
                            <li class="navitem">
                                <a href="../Testing_Episodic_Log/" class="nav-link">Episodic Log</a>
                            </li>
                            <li class="navitem">
                                <a href="../TEAM_INBOX/" class="nav-link">Team Inbox</a>
                            </li>
                            <li class="navitem">
                                <a href="../DEV_WORKFLOW_DIAGRAM/" class="nav-link">Development Workflow Diagram</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKFLOW_UPDATE_ANALYSIS/" class="nav-link">Workflow Update Analysis</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_SKILLS_ARCHITECTURE/" class="nav-link">Skills Architecture Research</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_VM_STORAGE_MIGRATION/" class="nav-link">VM Storage Migration Research</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#prd-privacy-report-purchase-flow" class="nav-link">PRD: Privacy Report Purchase Flow</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#1-executive-summary" class="nav-link">1. Executive Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2-current-state" class="nav-link">2. Current State</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3-target-architecture" class="nav-link">3. Target Architecture</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#4-implementation-phases" class="nav-link">4. Implementation Phases</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#5-api-specifications" class="nav-link">5. API Specifications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#6-wordpresswoocommerce-configuration" class="nav-link">6. WordPress/WooCommerce Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#7-data-flow" class="nav-link">7. Data Flow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#8-security-considerations" class="nav-link">8. Security Considerations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#9-testing-checklist" class="nav-link">9. Testing Checklist</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#10-rollback-plan" class="nav-link">10. Rollback Plan</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#11-future-enhancements" class="nav-link">11. Future Enhancements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#12-dependencies" class="nav-link">12. Dependencies</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#appendix-a-secrets-required" class="nav-link">Appendix A: Secrets Required</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#appendix-b-price-recommendation" class="nav-link">Appendix B: Price Recommendation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#13-data-storage-architecture-sqlite-no-airtable" class="nav-link">13. Data Storage Architecture (SQLite - No Airtable)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#14-stress-testing-phase-pre-launch" class="nav-link">14. Stress Testing Phase (Pre-Launch)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="prd-privacy-report-purchase-flow">PRD: Privacy Report Purchase Flow</h1>
<p><strong>Version:</strong> 1.0
<strong>Date:</strong> 2025-12-03
<strong>Status:</strong> APPROVED
<strong>Priority:</strong> HIGH</p>
<hr />
<h2 id="1-executive-summary">1. Executive Summary</h2>
<p>Build an automated end-to-end flow from privacy questionnaire submission to paid report delivery, integrated with the existing WordPress/WooCommerce store at eislaw.org.</p>
<h3 id="business-goal">Business Goal</h3>
<p>Convert privacy questionnaire leads into paying customers automatically, with minimal manual intervention.</p>
<h3 id="success-metrics">Success Metrics</h3>
<ul>
<li>Time from submission to purchase option: &lt; 5 seconds</li>
<li>Conversion rate tracking via WooCommerce</li>
<li>Zero manual steps in happy path</li>
</ul>
<hr />
<h2 id="2-current-state">2. Current State</h2>
<h3 id="what-exists">What Exists</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Status</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fillout questionnaire</td>
<td>✅ Live</td>
<td>Form ID: t9nJNoMdBgus</td>
</tr>
<tr>
<td>Scoring algorithm</td>
<td>✅ Working</td>
<td>fillout_integration.py</td>
</tr>
<tr>
<td>QA validation tab</td>
<td>✅ Built</td>
<td>Privacy tab in dashboard</td>
</tr>
<tr>
<td>WooCommerce store</td>
<td>✅ Live</td>
<td>eislaw.org</td>
</tr>
<tr>
<td>Invoice4U payments</td>
<td>✅ Installed</td>
<td>Israeli payment gateway</td>
</tr>
<tr>
<td>WordPress API access</td>
<td>✅ Configured</td>
<td>secrets.local.json</td>
</tr>
</tbody>
</table>
<h3 id="whats-missing">What's Missing</h3>
<ol>
<li>Results page showing score to user</li>
<li>WooCommerce product for privacy report</li>
<li>Fillout redirect to results page</li>
<li>Purchase flow integration</li>
<li>Report generation after purchase</li>
<li>Delivery mechanism</li>
</ol>
<hr />
<h2 id="3-target-architecture">3. Target Architecture</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                     USER JOURNEY                                 │
└─────────────────────────────────────────────────────────────────┘

[1] User fills Fillout form
         │
         ▼
[2] Fillout redirects to Results Page
    URL: eislaw.org/privacy-results?submission_id=XXX
         │
         ▼
[3] Results Page shows:
    - Privacy level (בסיסית/בינונית/גבוהה)
    - Key requirements
    - CTA: &quot;לרכישת הדוח המלא&quot; button
         │
         ▼
[4] Button links to WooCommerce checkout
    URL: eislaw.org/checkout?add-to-cart=PRODUCT_ID
         │
         ▼
[5] User pays via Invoice4U
         │
         ▼
[6] WooCommerce webhook → Our API
    POST /api/woocommerce/order-complete
         │
         ▼
[7] Generate PDF report
         │
         ▼
[8] Email report to customer
</code></pre>
<hr />
<h2 id="4-implementation-phases">4. Implementation Phases</h2>
<h3 id="phase-1-woocommerce-product-day-1">Phase 1: WooCommerce Product (Day 1)</h3>
<p><strong>Priority:</strong> CRITICAL</p>
<ul>
<li>[ ] Create WooCommerce product via API:</li>
<li>Name: דוח הגנת פרטיות מותאם אישית</li>
<li>Type: Virtual (no shipping)</li>
<li>Price: TBD (suggest ₪299-499)</li>
<li>SKU: privacy-report-v1</li>
<li>[ ] Add custom field for submission_id</li>
<li>[ ] Configure thank-you page redirect</li>
</ul>
<p><strong>Files to modify:</strong>
- None (API call only)</p>
<p><strong>Testing:</strong>
- [ ] Product appears in WooCommerce admin
- [ ] Can add to cart via URL parameter
- [ ] Checkout works with Invoice4U</p>
<hr />
<h3 id="phase-2-results-page-on-wordpress-day-1-2">Phase 2: Results Page on WordPress (Day 1-2)</h3>
<p><strong>Priority:</strong> CRITICAL</p>
<ul>
<li>[ ] Create WordPress page: /privacy-results</li>
<li>[ ] Build with Elementor (matches site style)</li>
<li>[ ] Dynamic content based on URL params:</li>
<li>submission_id</li>
<li>level (from API call)</li>
<li>[ ] Hebrew RTL layout</li>
<li>[ ] Mobile responsive</li>
</ul>
<p><strong>Page sections:</strong>
1. Header: "תוצאות בדיקת הפרטיות שלך"
2. Level badge with explanation
3. Key findings summary
4. CTA button to purchase
5. Contact info for questions</p>
<p><strong>API endpoint needed:</strong></p>
<pre><code>GET /api/privacy/public-results/{submission_id}
Returns: { level, level_label, key_points[], price }
</code></pre>
<p><strong>Files to modify:</strong>
- backend/main.py - Add public results endpoint</p>
<hr />
<h3 id="phase-3-fillout-redirect-configuration-day-2">Phase 3: Fillout Redirect Configuration (Day 2)</h3>
<p><strong>Priority:</strong> HIGH</p>
<ul>
<li>[ ] Configure Fillout form completion redirect</li>
<li>[ ] URL: https://eislaw.org/privacy-results?submission_id={{submissionId}}</li>
<li>[ ] Test redirect works</li>
</ul>
<p><strong>No code changes needed</strong> - Fillout admin configuration only</p>
<hr />
<h3 id="phase-4-purchase-flow-integration-day-2-3">Phase 4: Purchase Flow Integration (Day 2-3)</h3>
<p><strong>Priority:</strong> HIGH</p>
<ul>
<li>[ ] Add submission_id to WooCommerce order meta</li>
<li>[ ] Create WooCommerce webhook for order completion</li>
<li>[ ] Build webhook handler endpoint</li>
</ul>
<p><strong>Webhook endpoint:</strong></p>
<pre><code>POST /api/woocommerce/order-complete
Headers: X-WC-Webhook-Signature
Body: { order_id, status, meta_data[] }
</code></pre>
<p><strong>Files to modify:</strong>
- backend/main.py - Add webhook endpoint
- backend/woocommerce_integration.py - New module</p>
<hr />
<h3 id="phase-5-report-generation-day-3-4">Phase 5: Report Generation (Day 3-4)</h3>
<p><strong>Priority:</strong> MEDIUM</p>
<ul>
<li>[ ] Create PDF report template</li>
<li>[ ] Generate report based on submission answers</li>
<li>[ ] Include:</li>
<li>Business name</li>
<li>Privacy level determination</li>
<li>Required actions checklist</li>
<li>Relevant regulations</li>
<li>Next steps</li>
</ul>
<p><strong>Files to modify:</strong>
- backend/report_generator.py - New module
- templates/privacy_report.html - Report template</p>
<hr />
<h3 id="phase-6-email-delivery-day-4">Phase 6: Email Delivery (Day 4)</h3>
<p><strong>Priority:</strong> MEDIUM</p>
<ul>
<li>[ ] Send report via email after purchase</li>
<li>[ ] Hebrew email template</li>
<li>[ ] Attach PDF report</li>
<li>[ ] Include support contact</li>
</ul>
<p><strong>Files to modify:</strong>
- backend/email_service.py - New or extend existing</p>
<hr />
<h2 id="5-api-specifications">5. API Specifications</h2>
<h3 id="51-public-results-endpoint">5.1 Public Results Endpoint</h3>
<pre><code>GET /api/privacy/public-results/{submission_id}

Response 200:
{
  &quot;submission_id&quot;: &quot;abc123&quot;,
  &quot;level&quot;: &quot;mid&quot;,
  &quot;level_label&quot;: &quot;בינונית&quot;,
  &quot;level_description&quot;: &quot;העסק שלך מחזיק מידע על 100-1000 אנשים...&quot;,
  &quot;key_points&quot;: [
    &quot;נדרש מינוי ממונה הגנת פרטיות&quot;,
    &quot;חובת רישום מאגר מידע&quot;
  ],
  &quot;product_url&quot;: &quot;https://eislaw.org/checkout?add-to-cart=XXXX&quot;,
  &quot;price&quot;: 299,
  &quot;currency&quot;: &quot;ILS&quot;
}

Response 404:
{ &quot;error&quot;: &quot;Submission not found&quot; }
</code></pre>
<h3 id="52-woocommerce-webhook-handler">5.2 WooCommerce Webhook Handler</h3>
<pre><code>POST /api/woocommerce/order-complete

Headers:
  X-WC-Webhook-Signature: &lt;hmac-sha256&gt;
  Content-Type: application/json

Body:
{
  &quot;id&quot;: 12345,
  &quot;status&quot;: &quot;completed&quot;,
  &quot;billing&quot;: {
    &quot;email&quot;: &quot;customer@example.com&quot;,
    &quot;first_name&quot;: &quot;ישראל&quot;,
    &quot;last_name&quot;: &quot;ישראלי&quot;
  },
  &quot;meta_data&quot;: [
    { &quot;key&quot;: &quot;submission_id&quot;, &quot;value&quot;: &quot;abc123&quot; }
  ]
}

Response 200:
{ &quot;status&quot;: &quot;ok&quot;, &quot;report_sent&quot;: true }
</code></pre>
<hr />
<h2 id="6-wordpresswoocommerce-configuration">6. WordPress/WooCommerce Configuration</h2>
<h3 id="61-product-settings">6.1 Product Settings</h3>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Product Type</td>
<td>Simple, Virtual</td>
</tr>
<tr>
<td>Price</td>
<td>₪299 (suggested)</td>
</tr>
<tr>
<td>Tax Status</td>
<td>Taxable</td>
</tr>
<tr>
<td>SKU</td>
<td>privacy-report-v1</td>
</tr>
<tr>
<td>Sold Individually</td>
<td>Yes</td>
</tr>
<tr>
<td>Stock</td>
<td>Unlimited</td>
</tr>
</tbody>
</table>
<h3 id="62-webhook-configuration">6.2 Webhook Configuration</h3>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Privacy Report Order Complete</td>
</tr>
<tr>
<td>Status</td>
<td>Active</td>
</tr>
<tr>
<td>Topic</td>
<td>Order completed</td>
</tr>
<tr>
<td>Delivery URL</td>
<td>https://20.217.86.4:8799/api/woocommerce/order-complete</td>
</tr>
<tr>
<td>Secret</td>
<td>(generate and store in secrets.local.json)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7-data-flow">7. Data Flow</h2>
<h3 id="fillout-results-page">Fillout → Results Page</h3>
<pre><code>Fillout completion
    → Redirect with submission_id
    → Results page loads
    → Fetch /api/privacy/public-results/{id}
    → Display results + purchase button
</code></pre>
<h3 id="purchase-delivery">Purchase → Delivery</h3>
<pre><code>User clicks purchase
    → WooCommerce cart (submission_id in URL)
    → Checkout (Invoice4U)
    → Payment complete
    → WooCommerce webhook fires
    → Our API generates report
    → Email sent to customer
</code></pre>
<hr />
<h2 id="8-security-considerations">8. Security Considerations</h2>
<ol>
<li><strong>Public results endpoint</strong>: Only expose level and key points, not full answers</li>
<li><strong>Webhook signature</strong>: Validate X-WC-Webhook-Signature</li>
<li><strong>Rate limiting</strong>: Prevent abuse of public endpoint</li>
<li><strong>submission_id</strong>: Use UUID, not sequential</li>
</ol>
<hr />
<h2 id="9-testing-checklist">9. Testing Checklist</h2>
<h3 id="phase-1-product">Phase 1: Product</h3>
<ul>
<li>[ ] Product created in WooCommerce</li>
<li>[ ] Can add to cart via URL</li>
<li>[ ] Checkout flow works</li>
<li>[ ] Invoice4U payment succeeds</li>
</ul>
<h3 id="phase-2-results-page">Phase 2: Results Page</h3>
<ul>
<li>[ ] Page loads with valid submission_id</li>
<li>[ ] Shows correct level</li>
<li>[ ] Purchase button works</li>
<li>[ ] Mobile responsive</li>
</ul>
<h3 id="phase-3-redirect">Phase 3: Redirect</h3>
<ul>
<li>[ ] Fillout redirects correctly</li>
<li>[ ] submission_id passes through</li>
</ul>
<h3 id="phase-4-webhook">Phase 4: Webhook</h3>
<ul>
<li>[ ] Webhook fires on order complete</li>
<li>[ ] Signature validates</li>
<li>[ ] submission_id extracted correctly</li>
</ul>
<h3 id="phase-5-report">Phase 5: Report</h3>
<ul>
<li>[ ] PDF generates correctly</li>
<li>[ ] Contains all required sections</li>
<li>[ ] Hebrew text renders properly</li>
</ul>
<h3 id="phase-6-email">Phase 6: Email</h3>
<ul>
<li>[ ] Email sends successfully</li>
<li>[ ] PDF attached</li>
<li>[ ] Links work</li>
</ul>
<hr />
<h2 id="10-rollback-plan">10. Rollback Plan</h2>
<p>Each phase is independent. If any phase fails:
1. Disable webhook (WooCommerce admin)
2. Remove results page (WordPress admin)
3. Unpublish product (WooCommerce admin)
4. Revert API changes (git revert)</p>
<hr />
<h2 id="11-future-enhancements">11. Future Enhancements</h2>
<ul>
<li>[ ] Upsell: Full consultation package</li>
<li>[ ] Subscription: Annual compliance check</li>
<li>[ ] Dashboard: Customer portal for report access</li>
<li>[ ] Analytics: Conversion funnel tracking</li>
</ul>
<hr />
<h2 id="12-dependencies">12. Dependencies</h2>
<table>
<thead>
<tr>
<th>Dependency</th>
<th>Status</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fillout API</td>
<td>✅ Ready</td>
<td>Form t9nJNoMdBgus</td>
</tr>
<tr>
<td>WooCommerce API</td>
<td>✅ Ready</td>
<td>Keys in secrets.local.json</td>
</tr>
<tr>
<td>Invoice4U</td>
<td>✅ Installed</td>
<td>Israeli payments</td>
</tr>
<tr>
<td>Email service</td>
<td>⚠️ TBD</td>
<td>Need to configure</td>
</tr>
<tr>
<td>PDF generation</td>
<td>⚠️ TBD</td>
<td>Library needed</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="appendix-a-secrets-required">Appendix A: Secrets Required</h2>
<pre><code class="language-json">{
  &quot;wordpress&quot;: {
    &quot;site_url&quot;: &quot;https://eislaw.org&quot;,
    &quot;username&quot;: &quot;eislaw&quot;,
    &quot;app_password&quot;: &quot;****&quot;,
    &quot;wc_consumer_key&quot;: &quot;ck_****&quot;,
    &quot;wc_consumer_secret&quot;: &quot;cs_****&quot;,
    &quot;wc_webhook_secret&quot;: &quot;****&quot;
  }
}
</code></pre>
<hr />
<h2 id="appendix-b-price-recommendation">Appendix B: Price Recommendation</h2>
<p>Based on market research for privacy compliance reports:
- Basic report: ₪199-299
- Full report with consultation: ₪499-799
- Annual subscription: ₪999/year</p>
<p>Suggested starting price: <strong>₪299</strong> (can adjust based on conversion data)</p>
<hr />
<h2 id="13-data-storage-architecture-sqlite-no-airtable">13. Data Storage Architecture (SQLite - No Airtable)</h2>
<h3 id="decision">Decision</h3>
<p>Use SQLite instead of Airtable for privacy submissions storage.</p>
<h3 id="rationale">Rationale</h3>
<ul>
<li>Fillout is the source of truth for raw submissions</li>
<li>No need for external database service</li>
<li>SQLite handles 3-4 writes/minute easily (capacity: 50,000+/min)</li>
<li>ACID compliant, survives crashes</li>
<li>Zero configuration, single file</li>
<li>Free (no Airtable costs)</li>
</ul>
<h3 id="sqlite-schema">SQLite Schema</h3>
<pre><code class="language-sql">-- Privacy submissions from Fillout
CREATE TABLE privacy_submissions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    submission_id TEXT UNIQUE NOT NULL,
    form_id TEXT NOT NULL,
    submitted_at TEXT NOT NULL,
    received_at TEXT DEFAULT CURRENT_TIMESTAMP,

    -- Contact info
    contact_name TEXT,
    contact_email TEXT,
    contact_phone TEXT,
    business_name TEXT,

    -- Raw answers (JSON)
    answers_json TEXT,

    -- Algorithm results
    score_level TEXT,  -- lone/basic/mid/high
    score_dpo BOOLEAN DEFAULT FALSE,
    score_reg BOOLEAN DEFAULT FALSE,
    score_report BOOLEAN DEFAULT FALSE,
    score_requirements TEXT,  -- JSON array
    score_confidence INTEGER,

    -- Review status
    review_status TEXT DEFAULT pending,  -- pending/correct/override
    reviewed_at TEXT,
    override_level TEXT,
    override_reason TEXT,

    -- Purchase status
    purchase_status TEXT DEFAULT none,  -- none/pending/completed
    order_id TEXT,
    purchased_at TEXT,

    -- Report delivery
    report_status TEXT DEFAULT none,  -- none/generating/sent/failed
    report_url TEXT,
    sent_at TEXT
);

-- Activity log for monitoring
CREATE TABLE activity_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp TEXT DEFAULT CURRENT_TIMESTAMP,
    event_type TEXT NOT NULL,  -- webhook_received/scored/error/purchased/report_sent
    submission_id TEXT,
    details TEXT,  -- JSON
    duration_ms INTEGER,
    success BOOLEAN DEFAULT TRUE
);

-- Indexes
CREATE INDEX idx_submissions_status ON privacy_submissions(review_status);
CREATE INDEX idx_submissions_submitted ON privacy_submissions(submitted_at);
CREATE INDEX idx_activity_timestamp ON activity_log(timestamp);
</code></pre>
<h3 id="file-location">File Location</h3>
<pre><code>/app/data/privacy.db  (Docker mount: ~/EISLAWManagerWebApp/data/privacy.db)
</code></pre>
<h3 id="backup-strategy">Backup Strategy</h3>
<ul>
<li>SQLite file copied to Azure Blob daily (optional)</li>
<li>Or: git-ignored local backup script</li>
</ul>
<hr />
<h2 id="14-stress-testing-phase-pre-launch">14. Stress Testing Phase (Pre-Launch)</h2>
<h3 id="purpose">Purpose</h3>
<p>Validate pipeline reliability before production traffic.</p>
<h3 id="test-scenarios">Test Scenarios</h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Rate</th>
<th>Duration</th>
<th>Expected</th>
</tr>
</thead>
<tbody>
<tr>
<td>Normal</td>
<td>3-4/min</td>
<td>10 min</td>
<td>0 errors</td>
</tr>
<tr>
<td>Burst</td>
<td>20/min</td>
<td>2 min</td>
<td>0 errors</td>
</tr>
<tr>
<td>Sustained</td>
<td>10/min</td>
<td>30 min</td>
<td>0 errors</td>
</tr>
</tbody>
</table>
<h3 id="stress-test-tool">Stress Test Tool</h3>
<p><code>tools/stress_test_privacy.py</code></p>
<p>Features:
- Simulate Fillout webhook calls
- Configurable rate and duration
- Measure response time, error rate
- Generate report</p>
<h3 id="monitor-panel">Monitor Panel</h3>
<p>Add to Privacy tab in dashboard:
- Live activity feed
- Error count
- Throughput metrics
- Last 100 events</p>
<h3 id="success-criteria">Success Criteria</h3>
<ul>
<li>99.9% success rate at 10/min for 30 min</li>
<li>Average response time &lt; 500ms</li>
<li>No memory leaks</li>
<li>SQLite file size reasonable</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
