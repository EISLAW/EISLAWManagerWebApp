<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.local/TASK_DAVID_STORAGE_MIGRATION_RESEARCH/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>TASK: VM Storage Migration Research - EISLAW Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">EISLAW Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../INDEX/" class="nav-link">Index</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKING_MEMORY/" class="nav-link">Working Memory</a>
                            </li>
                            <li class="navitem">
                                <a href="../Testing_Episodic_Log/" class="nav-link">Episodic Log</a>
                            </li>
                            <li class="navitem">
                                <a href="../TEAM_INBOX/" class="nav-link">Team Inbox</a>
                            </li>
                            <li class="navitem">
                                <a href="../DEV_WORKFLOW_DIAGRAM/" class="nav-link">Development Workflow Diagram</a>
                            </li>
                            <li class="navitem">
                                <a href="../WORKFLOW_UPDATE_ANALYSIS/" class="nav-link">Workflow Update Analysis</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_SKILLS_ARCHITECTURE/" class="nav-link">Skills Architecture Research</a>
                            </li>
                            <li class="navitem">
                                <a href="../RESEARCH_VM_STORAGE_MIGRATION/" class="nav-link">VM Storage Migration Research</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#task-vm-storage-migration-research" class="nav-link">TASK: VM Storage Migration Research</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#task-overview" class="nav-link">Task Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#objectives" class="nav-link">Objectives</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#detailed-requirements" class="nav-link">Detailed Requirements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#key-questions-to-answer" class="nav-link">Key Questions to Answer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#deliverables" class="nav-link">Deliverables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#success-criteria" class="nav-link">Success Criteria</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#git-workflow" class="nav-link">Git Workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#notes" class="nav-link">Notes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#chat-integration" class="nav-link">Chat Integration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="task-vm-storage-migration-research">TASK: VM Storage Migration Research</h1>
<p><strong>Task ID:</strong> STORAGE-001
<strong>Assigned To:</strong> David (Senior Product)
<strong>Assigned By:</strong> Joe
<strong>Date Assigned:</strong> 2025-12-12
<strong>Status:</strong> üîÑ NEW
<strong>Branch:</strong> feature/STORAGE-001
<strong>Model:</strong> Codex (default for David)</p>
<hr />
<h2 id="task-overview">Task Overview</h2>
<p>Research and create a comprehensive plan to migrate files from Azure VM disk storage to Azure Blob Storage and/or SharePoint. The goal is to free up VM disk space and make the system more scalable by moving the VM toward a stateless architecture.</p>
<p><strong>Context:</strong> CEO asked: "Is there a reason we store anything (such as the emails) on the VM?" The answer is no - storing large files on VM disk is expensive, risky, and doesn't scale. This research will identify what can be moved and how.</p>
<hr />
<h2 id="objectives">Objectives</h2>
<ol>
<li><strong>Analyze current VM storage usage</strong> - SSH to VM and identify what's stored on disk</li>
<li><strong>Categorize files</strong> - Determine what should stay on VM vs move to Blob/SharePoint</li>
<li><strong>Map database dependencies</strong> - Identify all database tables/columns that reference file paths</li>
<li><strong>Create migration plan</strong> - Step-by-step plan with code changes, DB migrations, cost analysis</li>
<li><strong>Produce comprehensive research document</strong> with recommendations for implementation</li>
</ol>
<hr />
<h2 id="detailed-requirements">Detailed Requirements</h2>
<h3 id="1-vm-storage-analysis">1. VM Storage Analysis</h3>
<p><strong>SSH to VM and analyze disk usage:</strong></p>
<pre><code class="language-bash">ssh -i ~/.ssh/eislaw-dev-vm.pem azureuser@20.217.86.4

# Analyze disk usage
df -h
du -h --max-depth=2 /home/azureuser | sort -hr | head -20
du -h --max-depth=2 ~/EISLAWManagerWebApp | sort -hr | head -20

# Look for specific data directories
ls -lah ~/emails/
ls -lah ~/EISLAWManagerWebApp/backend/uploads/
ls -lah ~/EISLAWManagerWebApp/backend/storage/
find ~/EISLAWManagerWebApp -type f -name &quot;*.eml&quot; -o -name &quot;*.pdf&quot; -o -name &quot;*.docx&quot; | head -20
find /home/azureuser -type f -size +10M | head -20
</code></pre>
<p><strong>Deliverable:</strong> Markdown table showing:
- Directory path
- Current size
- File types stored
- Purpose (emails, uploads, logs, etc.)
- Can be moved? (Yes/No/Maybe)</p>
<h3 id="2-file-categorization">2. File Categorization</h3>
<p><strong>Create a decision matrix for what to move:</strong></p>
<table>
<thead>
<tr>
<th>Storage Location</th>
<th>What Should Be Here</th>
<th>What Shouldn't Be Here</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>VM Disk</strong></td>
<td>Application code (Docker containers)<br>PostgreSQL database<br>Config files<br>Short-term logs (rotated)</td>
<td>Emails<br>Client documents<br>Backups<br>Large exports<br>Media files</td>
</tr>
<tr>
<td><strong>Azure Blob Storage</strong></td>
<td>Emails (.eml files)<br>Email attachments<br>Backups<br>Large exports/reports<br>Logs archives</td>
<td>Application code<br>Database files<br>Config files</td>
</tr>
<tr>
<td><strong>SharePoint</strong></td>
<td>Client documents (already there)<br>Templates<br>Shared files</td>
<td>System logs<br>Application data</td>
</tr>
</tbody>
</table>
<p><strong>Deliverable:</strong> Table categorizing every file type currently on VM</p>
<h3 id="3-database-schema-analysis">3. Database Schema Analysis</h3>
<p><strong>Find all database references to file paths:</strong></p>
<pre><code class="language-bash"># On VM, check SQLite databases
cd ~/EISLAWManagerWebApp/backend

# Search for file path columns
sqlite3 eislaw.db &quot;SELECT sql FROM sqlite_master WHERE type='table';&quot; | grep -i 'path\|file\|url'

# Search for email-related tables
sqlite3 eislaw.db &quot;.schema&quot; | grep -i email

# Check what tables might reference files
sqlite3 eislaw.db &quot;SELECT name FROM sqlite_master WHERE type='table';&quot;
</code></pre>
<p><strong>Also check:</strong>
- <code>backend/models/</code> - SQLAlchemy models that reference files
- <code>backend/api/</code> - API endpoints that save/retrieve files
- <code>docs/DATA_STORES.md</code> - Current data architecture documentation</p>
<p><strong>Deliverable:</strong> Table of database schema changes needed:</p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Column</th>
<th>Current Type</th>
<th>New Type</th>
<th>Migration Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>emails</code></td>
<td><code>file_path</code></td>
<td><code>TEXT</code> (local path)</td>
<td><code>blob_url</code> (Azure URL)</td>
<td>Yes - migrate existing records</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<h3 id="4-azure-blob-storage-research">4. Azure Blob Storage Research</h3>
<p><strong>Research Azure Blob Storage setup:</strong></p>
<ul>
<li>Pricing: Hot vs Cool vs Archive tiers</li>
<li>SDK usage: <code>azure-storage-blob</code> Python library</li>
<li>Authentication: Connection string vs managed identity</li>
<li>Container structure: How to organize files</li>
<li>Security: Access control, SAS tokens</li>
</ul>
<p><strong>Example code pattern to include:</strong></p>
<pre><code class="language-python">from azure.storage.blob import BlobServiceClient

# Upload email to Blob
blob_client = blob_service.get_blob_client(
    container=&quot;eislaw-emails&quot;,
    blob=f&quot;{client_id}/{email_id}.eml&quot;
)
blob_client.upload_blob(email_content)

# Get URL for database
blob_url = blob_client.url
# Store blob_url in PostgreSQL instead of file_path
</code></pre>
<p><strong>Deliverable:</strong> Code examples and cost estimates</p>
<h3 id="5-migration-plan">5. Migration Plan</h3>
<p><strong>Create step-by-step implementation plan:</strong></p>
<p><strong>Phase 1: Setup Azure Blob</strong>
- Create Azure Storage Account
- Create containers (eislaw-emails, eislaw-backups, eislaw-exports)
- Configure access policies
- Add credentials to secrets.local.json</p>
<p><strong>Phase 2: Update Backend Code</strong>
- Install <code>azure-storage-blob</code> in requirements.txt
- Create <code>backend/services/blob_storage.py</code> helper
- Update email ingestion endpoints to save to Blob
- Update file retrieval endpoints to fetch from Blob</p>
<p><strong>Phase 3: Database Migration</strong>
- Add new columns (e.g., <code>blob_url</code>) to relevant tables
- Create migration script to move existing files to Blob
- Update database records with new URLs
- Verify data integrity</p>
<p><strong>Phase 4: Cleanup</strong>
- Archive or delete migrated files from VM
- Monitor disk usage reduction
- Update documentation</p>
<p><strong>Deliverable:</strong> Detailed migration plan with code snippets</p>
<h3 id="6-cost-analysis">6. Cost Analysis</h3>
<p><strong>Compare costs:</strong></p>
<table>
<thead>
<tr>
<th>Storage Type</th>
<th>Current Cost (estimate)</th>
<th>Post-Migration Cost</th>
<th>Monthly Savings</th>
</tr>
</thead>
<tbody>
<tr>
<td>VM Disk (128GB)</td>
<td>~$25-40</td>
<td>~$10-15 (smaller disk)</td>
<td>~$15-25</td>
</tr>
<tr>
<td>Azure Blob (Hot)</td>
<td>$0</td>
<td>~$2-5 (for 100GB)</td>
<td>-$2-5</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td>~$25-40</td>
<td>~$12-20</td>
<td>~$13-20/month</td>
</tr>
</tbody>
</table>
<p><strong>Annual savings estimate:</strong> ~$150-240/year</p>
<p><strong>Deliverable:</strong> Cost comparison table with assumptions documented</p>
<hr />
<h2 id="key-questions-to-answer">Key Questions to Answer</h2>
<ol>
<li><strong>What's currently stored on VM disk?</strong> (file types, sizes, locations)</li>
<li><strong>What can be moved to Blob?</strong> (emails, documents, backups, logs)</li>
<li><strong>What must stay on VM?</strong> (code, configs, database)</li>
<li><strong>What database changes are needed?</strong> (new columns, migrations)</li>
<li><strong>What's the migration complexity?</strong> (simple, moderate, complex)</li>
<li><strong>What's the cost/benefit?</strong> (savings vs implementation effort)</li>
<li><strong>Are there any risks?</strong> (data loss, downtime, performance)</li>
</ol>
<hr />
<h2 id="references">References</h2>
<p><strong>Documentation to read:</strong>
- <code>docs/DATA_STORES.md</code> - Current data architecture
- <code>docs/API_ENDPOINTS_INVENTORY.md</code> - API endpoints that handle files
- <code>docs/RAG_FEATURES_SPEC.md</code> - Email/document indexing system
- <code>CLAUDE.md</code> ¬ß3 - VM configuration and services
- Azure Blob Storage docs: https://learn.microsoft.com/en-us/azure/storage/blobs/</p>
<p><strong>VM Access:</strong></p>
<pre><code class="language-bash">ssh -i ~/.ssh/eislaw-dev-vm.pem azureuser@20.217.86.4
cd ~/EISLAWManagerWebApp
</code></pre>
<hr />
<h2 id="deliverables">Deliverables</h2>
<p>Create a comprehensive research document: <code>docs/RESEARCH_VM_STORAGE_MIGRATION.md</code></p>
<p><strong>Document should include:</strong></p>
<ol>
<li><strong>Executive Summary</strong> - Key findings and recommendations (1 page)</li>
<li><strong>Current State Analysis</strong> - What's on VM disk now (with disk usage table)</li>
<li><strong>File Categorization</strong> - What stays vs what moves (decision matrix)</li>
<li><strong>Database Impact Analysis</strong> - Schema changes needed (table)</li>
<li><strong>Azure Blob Architecture</strong> - Container structure, code patterns, security</li>
<li><strong>Migration Plan</strong> - Phased implementation steps (detailed)</li>
<li><strong>Cost Analysis</strong> - Before/after comparison with ROI calculation</li>
<li><strong>Risk Assessment</strong> - Potential issues and mitigations</li>
<li><strong>Recommendations</strong> - Priority order (emails first, then backups, etc.)</li>
<li><strong>Appendix</strong> - Code examples, commands, reference links</li>
</ol>
<p><strong>Format:</strong> Markdown, well-structured with clear headings, tables, and code blocks.</p>
<hr />
<h2 id="success-criteria">Success Criteria</h2>
<ul>
<li>[ ] VM disk usage analyzed and documented</li>
<li>[ ] All file types categorized (stay vs move)</li>
<li>[ ] Database schema impact mapped completely</li>
<li>[ ] Azure Blob setup and code examples provided</li>
<li>[ ] Step-by-step migration plan created</li>
<li>[ ] Cost analysis completed with savings estimate</li>
<li>[ ] Research document created and comprehensive</li>
<li>[ ] MkDocs navigation updated (<code>mkdocs.yml</code>)</li>
<li>[ ] Completion message posted to TEAM_INBOX</li>
</ul>
<hr />
<h2 id="git-workflow">Git Workflow</h2>
<p><strong>CRITICAL GIT RULES:</strong>
- Work on branch: <code>feature/STORAGE-001</code> (already created by Joe)
- DO NOT git commit or push (Jacob will do this after review)
- Save all work locally only
- Post completion to TEAM_INBOX when done</p>
<hr />
<h2 id="notes">Notes</h2>
<p><strong>This is a research task, not an implementation task.</strong> You are NOT expected to:
- ‚ùå Implement Azure Blob integration (that's a future task for Alex)
- ‚ùå Migrate actual files (that's a future task with CEO approval)
- ‚ùå Make database schema changes (research only)</p>
<p><strong>You ARE expected to:</strong>
- ‚úÖ Analyze what's currently on the VM
- ‚úÖ Recommend what should be moved
- ‚úÖ Create a detailed plan for HOW to migrate
- ‚úÖ Provide cost/benefit analysis to help CEO decide
- ‚úÖ Write code examples to guide implementation</p>
<hr />
<h2 id="chat-integration">Chat Integration</h2>
<p><strong>Post progress updates using the Python helper:</strong></p>
<pre><code class="language-python">from tools.agent_chat import post_start, post_completion, post_message

# When starting work
post_start('David', 'STORAGE-001', 'VM Storage Migration Research', 'feature/STORAGE-001', '3-4 hours')

# During work (optional progress updates)
post_message('David', 'STORAGE-001', 'Completed VM disk analysis - 45GB in emails/', channel='agent-tasks')

# When complete
post_completion(
    'David', 'STORAGE-001',
    'VM Storage Migration Research',
    'Research doc created with migration plan and cost analysis',
    '3.5 hours', 'abc123def',
    'Jacob review',
    'STORAGE-002 (Alex implementation)'
)
</code></pre>
<hr />
<p><strong>Questions?</strong> Post to <code>#agent-tasks</code> or update TEAM_INBOX Messages TO Joe section.</p>
<p><strong>Ready to begin!</strong> üöÄ</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
